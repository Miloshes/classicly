!!! XML
!!! strict
%html{:xmlns => "http://www.w3.org/1999/html", "xmlns:og" => "http://ogp.me/ns#", "xmlns:fb" => "http://www.facebook.com/2008/fbml", "xml:lang" => "en", :lang => "en"}

%head
  = include_stylesheets :common
  
  = yield :title

  = javascript_include_tag 'http://www.google.com/jsapi'
  = javascript_tag do
    var theme = "flick";
    google.load("jquery", "1.4.4");
    google.load("jqueryui", "1.8.7");
    google.loader.writeLoadTag("css", "http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.7/themes/" + theme + "/jquery-ui.css");
  = include_javascripts :main
  = javascript_include_tag "http://cdn.jquerytools.org/1.2.5/tiny/jquery.tools.min.js"
  =# javascript_include_tag 'classicly-autocomplete'
  = javascript_include_tag 'http://connect.facebook.net/en_US/all.js'
  = csrf_meta_tag
  = typekit_include_helper

  %meta{"http-equiv" => 'content-type', :content => 'text/html;charset=utf-8'}
  %meta{:name => "google-site-verification", :content => "6O3-Qaesz8YLRESdSAbCarV1HzsC4F3dh4QTrTfmsj4"}
  = yield :head

  %body.bp.showgrid
    = yield :drawer
    <script type="text/javascript">
    var _kmq = _kmq || [];
    function _kms(u){
    setTimeout(function(){
    var s = document.createElement('script'); var f = document.getElementsByTagName('script')[0]; s.type = 'text/javascript'; s.async = true;
    s.src = u; f.parentNode.insertBefore(s, f);
    }, 1);
    }
    _kms('//i.kissmetrics.com/i.js');_kms('//doug1izaerwt3.cloudfront.net/95fd99a5f08a7e3b66a3ec13482c021a3fe30872.1.js');
    </script>
    #fb-root
    #header
      .wrap
        .top
          #logo
            %a{:href => '/'}
              = image_tag 'new_logo_classicly.png'
          #search
            = form_tag search_url, :method => :get do
              = text_field_tag "term", nil, :placeholder => 'Search', :tabIndex => 1
              %button{:name => 'commit', :type => 'submit', :value => 'search_submit'}

          #nav
            %ul
              %li
                %a.blog{:href => '/blog'} Blog
              %li
                = link_to  'Library', '/library'
          - unless current_login
            #signin
              = link_to "Sign In", "#"
          - else
            #profile-pic
              = link_to facebook_image(current_login.fb_connect_id), '/library'

    .clear
    #content
      #left-column
        = yield
      #right-column
        <a href="http://twitter.com/classiclyapp" class="twitter-follow-button" data-show-count="false">Follow @classiclyapp</a>
        <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
        <fb:like href="http://www.facebook.com/pages/Classicly/193128150712368" send="true" layout="button_count" width="200" show_faces="true" font=""></fb:like>
        .right-covers.audiobooks
          %p.popular
            Popular
          - for book in @popular_books
            .cover.small
              = cover_image_link_with_text(book, 2)
          - for collection in @popular_collections
            %a.collection_link{:href => "#{collection.cached_slug}"}
              .collection-with-title-here
                - for book in collection.books.limit(6)
                  .cover.mini
                    = cover_image_link(book, 1)
                = text_for_collection(collection)
          .clear
          .links
            .row
              .span4.columns
                = link_to 'See more popular books', '/best-of', :class => 'classicly-link'
            .row
              .span4.columns
                = link_to "Browse collections", '/collections', :class => 'classicly-link'
            .row
              .span4.columns
                = link_to "Browse authors", '/authors', :class => 'classicly-link'

      .clear
    = render '/shared/footer'
:javascript
  // initialize the environment for JS
  RAILS_ENV = "#{Rails.env}";
  // initialize Facebook
  FB.init({
  appId  : '#{Facebook::APP_ID}',
  status : true, // check login status
  cookie : true, // enable cookies to allow the server to access the session
  xfbml  : true  // parse XFBML
  });

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-35318016-7', 'auto');
  ga('send', 'pageview');
  ga('send', 'pageloadtime');

  (function() {
  var p = document.createElement('script');
  p.type = 'text/javascript'; p.async = true;
  p.src = '//d2f7h8c8hc0u7y.cloudfront.net/performable/pax/0HuiG9.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(p, s);
  })();

<script src="//d2f7h8c8hc0u7y.cloudfront.net/performable/pax/0HuiG9.js" type="text/javascript"></script>

<script type="text/javascript">
setTimeout(function(){var a=document.createElement("script");
var b=document.getElementsByTagName('script')[0];
a.src=document.location.protocol+"//dnn506yrbagrg.cloudfront.net/pages/scripts/0010/3575.js";
a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
</script>

<script type="text/javascript">var _kiq = _kiq || [];</script>
<script type="text/javascript" src="//s3.amazonaws.com/ki.js/3822/3dB.js" async="true"></script>
