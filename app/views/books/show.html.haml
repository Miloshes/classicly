- content_for :title do
  %title=@book.web_title
- content_for :head do
  - if @book.needs_canonical_link?
    %link{:rel => "canonical", :href => "http://www.classicly.com/#{@book.author.cached_slug}/#{@book.canonical_slug}" }
  = fb_open_graph_metadata({:url => author_book_url(@book.author, @book), :description => @book.description_for_open_graph,
      :image => "http://spreadsong-book-covers.s3.amazonaws.com/book_id#{@book.id}_size2.jpg",
      :title => "#{@book.author.name} - #{@book.pretty_title}", :type => 'book' })
  %meta{:name => 'description', :content => @book.description_for_open_graph}
      
- content_for :related_books do
  %span
    Related Books
  = render :partial => 'pages/cover', :collection => @related_books

#book-page.grid_9
  #cover.grid_2.alpha
    = image_tag "http://spreadsong-book-covers.s3.amazonaws.com/book_id#{@book.id}_size2.jpg",
      :alt => "#{@book.pretty_title} by #{@book.author.name}"
    - unless @books_from_the_same_collection.empty?
      .related-books
        %h4 Books from the same collection:
        = render :partial => "books/related_book", :collection => @books_from_the_same_collection, :as => :book
  .grid_7.omega
    #book-metadata.grid_5.omega
      %h1= @book.pretty_title
      %h2 
        by
        %span.book-author
          - if @book.belongs_to_author_collection? 
            #{link_to @book.author.name, seo_path(@book.author)}
          -else
            = @book.author.name
      .share
        <script src="http://connect.facebook.net/en_US/all.js#xfbml=1"></script><fb:like show_faces="true" width="600" font="arial" action='recommend'></fb:like>
      %p= simple_format(@book.description)
    .grid_2.omega.download-share
      .download_this_book
        = form_tag download_book_url(@book.author, @book) do
          %div.radio{:id => "radio_#{@book.id}"}
            - @book.classicly_formats.each_with_index do|format, index|
              = radio_button_for_format(format, index, @book)
          = link_to_function image_tag("download-this-book.png"), '$(this).parents("form").submit()'
      .clear
      .share-widgets
        .twitter-widget
          = javascript_include_tag "http://platform.twitter.com/widgets.js"
          = link_to "", "http://twitter.com/share?url=#{author_book_url(@book.author, @book)}&text=#{@book.web_title}&count=vertical", :class =>"twitter-share-button", :target => '_blank'
        .facebook-widget
          <script src="http://connect.facebook.net/en_US/all.js#xfbml=1"></script>
          <fb:like layout="box_count" show_faces="true" width="200" font="arial" action='recommend'>
          </fb:like>
    = image_tag '/images/divider.png', :class => 'divider'
    #reviews.grid_7
      #title-left
        Reviews
      #title-right
        = link_to 'Write a review', '#'
      .clear
      - if user_signed_in?
        = render :partial => 'review_form', :locals => {:review => @review, :book => @book}
      .clear
      %ul.reviews
        = render :partial => 'review', :collection => @book.reviews

= javascript_include_tag 'book-details'
:javascript
  $('#reviews').data('book_id', #{@book.id})
:javascript
  FB.init({
    appId  : '#{Facebook::APP_ID}',
    status : true, // check login status
    cookie : true, // enable cookies to allow the server to access the session
    xfbml  : true  // parse XFBML
  });

<script type="text/javascript">
if(RAILS_ENV == 'production'){
var _paq = _paq || [];
_paq.push(["trackConversion", {
id: "9i2hyK3hHAqF",
value: null
}]);
}
</script>
