- content_for :title do
  %title= seo_front_end_title_helper(@book)

- content_for :head do
  - if @book.needs_canonical_link?
    %link{:rel => "canonical", :href => "http://www.classicly.com/#{@book.author.cached_slug}/#{@book.canonical_slug}" }
  = fb_open_graph_metadata({:url => author_book_url(@book.author, @book), :description => seo_front_end_meta_description_text(@book),
      :image => "http://spreadsong-book-covers.s3.amazonaws.com/book_id#{@book.id}_size2.jpg",
      :title => "#{@book.author.name} - #{@book.pretty_title}", :type => 'book' }, @book.seo_info)
  = content_tag :meta, nil, :name => 'description', :content => seo_front_end_meta_description_text(@book)

= content_for :drawer do
  = render :partial => '/shared/connect_with_facebook_bar'


#book-page{:name => @book.id }
  .cover-column
    #current-book.cover.medium
      = cover_image_link(@book, 2)
    - unless @related_books.empty?
      %h4 Related
      .cover.small.related
        = cover_image_link_with_text(@related_books.first, 2)

      - 1.upto(@related_books.count - 1) do|index|
        .cover.tiny.related
          = cover_image_link_with_text(@related_books[index], 2)

  .book-column
    #book-metadata.grid_5.omega
      %h1= @book.pretty_title
      %h2
        by
        %span.book-author
          = book_author_link(@book)

      -# Google AdSense. DO NOT MODIFY.
      <script type="text/javascript"><!--
      google_ad_client = "ca-pub-7773516323337861";
      /* Book Page 250&#42;300 */
      google_ad_slot = "6647913200";
      google_ad_width = 300;
      google_ad_height = 250;
      //-->
      </script>
      <script type="text/javascript"
      src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
      </script>

      .like-send
        <fb:like show_faces="true" send="true" width="600" send="true" font="arial" action='recommend'></fb:like>
      %p= simple_format(@book.description)

      .download
        = link_to image_tag('download_pdf.png'), seo_url(@book.seo_slugs.pdf.first.slug) if @book.available_in_format?('pdf') && @book.has_slug_for_format?('pdf')
        = link_to image_tag('download_kindle.png'), seo_url(@book.seo_slugs.kindle.first.slug) if @book.available_in_format?('azw') && @book.has_slug_for_format?('kindle')
        = link_to image_tag('mp3-download_03.png'), seo_url(@book.audiobook_download_slug), :class => 'download-as-mp3' if @book.has_audiobook

      .read
        = link_to image_tag('read_online_big.png'), seo_url(@book.seo_slugs.read_online.first.slug), :class => 'read_online' if @book.read_online?

      %p.explanation.first Downloads on Classicly are completely free- these books are public domain.
      %p.explanation We donâ€™t pay a cent, so neither do you.

      .clear

      - if ab_test('reviews')
        #book-rating{:name => 'book' }
          - if @book.average_rating > 0
            = raw show_review_rating_stars(@book.average_rating)

        #reviews-rating-count
          #counts
            = show_review_counts @book

        #write-review
          = raw write_review_link(@book, current_login)

        = render :partial => 'books/review_form', :locals => {:book => @book, :login => current_login}

        .clear

        #reviews
          = render :partial => 'books/review', :collection => @book.reviews.with_content.most_recent

        = javascript_include_tag 'review-ratings'

:javascript
  if( _kmq == undefined) console.log('Kiss Metrics Queue is Undefined.');
  else _kmq.push([ 'record', 'Book Viewed', { 'name': "#{@book.pretty_title}" } ]);
