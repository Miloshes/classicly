#library-preview
  #container
    %p#copy
      Sync to iPhone and iPad.
      %br
      Read online. Download anytime.
    %a#register-button
      %span Create your free library
    = link_to "... or just keep browsing", '/', :id => 'browse'

:javascript
  $(function(){

    $( 'a#register-button' ).click( function(){

      if( _gaq ) _gaq.push([ '_trackEvent', 'registrations', 'add_library', 'reg_button_clicked' ]);
      $( "#fb_connect_notification" ).show("blind", { direction: "vertical" }, 1000);

      return false;

    });

    $( 'a#fb_connect' ).click( function(){

      FB.login(function(response) {
        // the user successfully logs in, let's register him and notify the Library model afterwards
        if ( response.session ) { 
          // register the user via the Login model:

          $.ajax({  type: "POST",
                    url: "/logins", dataType: "json",
                    success: function(data) {
                    // log new registrations to Performable 
                      if( data.is_new_login && RAILS_ENV == "production" ) {
                        _paq.push(["trackConversion", {id: "3F6mY45twfux", value: null}]);
                      }

                      // notify the Library model about the new registration
                      $.ajax({url: '#{library_handle_facebook_login_url}'});
                      $('#fb_connect_notification').hide( 'blind', { direction: 'vertical'}, 1000 );
                    }
          });

        } else {
          if ( _gaq ) _gaq.push( ['_trackEvent', 'registrations', 'add_library', 'reg_canceled'] );
        }
      });
      return false;
    });

    $( 'a#fb_decline' ).click( function(){
      window.location = '/';
    });

  });
