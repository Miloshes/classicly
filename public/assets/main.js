$(function(){});
(function(){$(function(){var a;a=$(".collection-here, .collection-with-title-here");return $.each(a,function(){var a,c,e,d;c=$(this);e=c.attr("name");a=c.hasClass("audiobooks");d=c.children(".cover-here");return $.getJSON("/collection_json_books",{id:e,total_books:d.size()},function(e){c.append('<div class="text"><a href="'+e[0].collection_slug+'"><span class="title">'+e[0].collection_name+'</span></a><span class="type">Collection</span></div>');return $.each(e,function(c,e){var b;b=e.books;return $.each(d,
function(){var g,c;c=b.length;g=b.splice(Math.floor(Math.random()*c),1);return c>0?a?setCoverForAudiobook($(this),g):setElementCover($(this),g):$(this).remove()})})})})})})();function unique(a){var f=[],c=0;a:for(;c<a.length;c++){for(var e=0;e<f.length;e++)if(f[e]==a[c])continue a;f[f.length]=a[c]}return f}
(function(a){function f(b){var g=a('meta[name="csrf-token"]').attr("content");g&&b.setRequestHeader("X-CSRF-Token",g)}function c(b,g,c){g=new a.Event(g);b.trigger(g,c);return g.result!==!1}function e(b){var g,d,e,h=b.attr("data-type")||a.ajaxSettings&&a.ajaxSettings.dataType;if(b.is("form")){g=b.attr("method");d=b.attr("action");e=b.serializeArray();var j=b.data("ujs:submit-button");j&&(e.push(j),b.data("ujs:submit-button",null))}else g=b.attr("data-method"),d=b.attr("href"),e=null;a.ajax({url:d,
type:g||"GET",data:e,dataType:h,beforeSend:function(a,g){g.dataType===void 0&&a.setRequestHeader("accept","*/*;q=0.5, "+g.accepts.script);return c(b,"ajax:beforeSend",[a,g])},success:function(a,g,c){b.trigger("ajax:success",[a,g,c])},complete:function(a,g){b.trigger("ajax:complete",[a,g])},error:function(a,g,c){b.trigger("ajax:error",[a,g,c])}})}function d(b){b.find("input[data-disable-with]").each(function(){var b=a(this);b.data("ujs:enable-with",b.val()).val(b.attr("data-disable-with")).attr("disabled",
"disabled")})}function j(b){b.find("input[data-disable-with]").each(function(){var b=a(this);b.val(b.data("ujs:enable-with")).removeAttr("disabled")})}function h(b){var a=b.attr("data-confirm");return!a||c(b,"confirm")&&confirm(a)}function i(b){var c=!1;b.find("input[name][required]").each(function(){a(this).val()||(c=!0)});return c}"ajaxPrefilter"in a?a.ajaxPrefilter(function(b,a,c){f(c)}):a(document).ajaxSend(function(b,a){f(a)});a("a[data-confirm], a[data-method], a[data-remote]").live("click.rails",
function(){var b=a(this);if(!h(b))return!1;if(b.attr("data-remote")!=void 0)return e(b),!1;else if(b.attr("data-method")){var c=b.attr("href"),d=b.attr("data-method");b=a("meta[name=csrf-token]").attr("content");var j=a("meta[name=csrf-param]").attr("content");c=a('<form method="post" action="'+c+'"></form>');d='<input name="_method" value="'+d+'" type="hidden" />';j!==void 0&&b!==void 0&&(d+='<input name="'+j+'" value="'+b+'" type="hidden" />');c.hide().append(d).appendTo("body");c.submit();return!1}});
a("form").live("submit.rails",function(){var b=a(this),c=b.attr("data-remote")!=void 0;if(!h(b))return!1;if(i(b))return!c;if(c)return e(b),!1;else setTimeout(function(){d(b)},13)});a("form input[type=submit], form button[type=submit], form button:not([type])").live("click.rails",function(){var b=a(this);if(!h(b))return!1;var c=b.attr("name");c=c?{name:c,value:b.val()}:null;b.closest("form").data("ujs:submit-button",c)});a("form").live("ajax:beforeSend.rails",function(b){this==b.target&&d(a(this))});
a("form").live("ajax:complete.rails",function(b){this==b.target&&j(a(this))})})(jQuery);
window.jQuery&&function(a){if(a.browser.msie)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(f){}a.fn.rating=function(c){if(this.length==0)return this;if(typeof arguments[0]=="string"){if(this.length>1){var e=arguments;return this.each(function(){a.fn.rating.apply(a(this),e)})}a.fn.rating[arguments[0]].apply(this,a.makeArray(arguments).slice(1)||[]);return this}c=a.extend({},a.fn.rating.options,c||{});a.fn.rating.calls++;this.not(".star-rating-applied").addClass("star-rating-applied").each(function(){var d,
e=a(this),h=(this.name||"unnamed-rating").replace(/\[|\]/g,"_").replace(/^\_+|\_+$/g,""),i=a(this.form||document.body),b=i.data("rating");if(!b||b.call!=a.fn.rating.calls)b={count:0,call:a.fn.rating.calls};var g=b[h];g&&(d=g.data("rating"));if(g&&d)d.count++;else{d=a.extend({},c||{},(a.metadata?e.metadata():a.meta?e.data():null)||{},{count:0,stars:[],inputs:[]});d.serial=b.count++;g=a('<span class="star-rating-control"/>');e.before(g);g.addClass("rating-to-be-drawn");if(e.attr("disabled"))d.readOnly=
!0;g.append(d.cancel=a('<div class="rating-cancel"><a title="'+d.cancel+'">'+d.cancelValue+"</a></div>").mouseover(function(){a(this).rating("drain");a(this).addClass("star-rating-hover")}).mouseout(function(){a(this).rating("draw");a(this).removeClass("star-rating-hover")}).click(function(){a(this).rating("select")}).data("rating",d))}var f=a('<div class="star-rating rater-'+d.serial+'"><a title="'+(this.title||this.value)+'">'+this.value+"</a></div>");g.append(f);this.id&&f.attr("id",this.id);this.className&&
f.addClass(this.className);if(d.half)d.split=2;if(typeof d.split=="number"&&d.split>0){var m=(a.fn.width?f.width():0)||d.starWidth,k=d.count%d.split;m=Math.floor(m/d.split);f.width(m).find("a").css({"margin-left":"-"+k*m+"px"})}d.readOnly?f.addClass("star-rating-readonly"):f.addClass("star-rating-live").mouseover(function(){a(this).rating("fill");a(this).rating("focus")}).mouseout(function(){a(this).rating("draw");a(this).rating("blur")}).click(function(){a(this).rating("select")});if(this.checked)d.current=
f;e.hide();e.change(function(){a(this).rating("select")});f.data("rating.input",e.data("rating.star",f));d.stars[d.stars.length]=f[0];d.inputs[d.inputs.length]=e[0];d.rater=b[h]=g;d.context=i;e.data("rating",d);g.data("rating",d);f.data("rating",d);i.data("rating",b)});a(".rating-to-be-drawn").rating("draw").removeClass("rating-to-be-drawn");return this};a.extend(a.fn.rating,{calls:0,focus:function(){var c=this.data("rating");if(!c)return this;if(!c.focus)return this;var e=a(this).data("rating.input")||
a(this.tagName=="INPUT"?this:null);c.focus&&c.focus.apply(e[0],[e.val(),a("a",e.data("rating.star"))[0]])},blur:function(){var c=this.data("rating");if(!c)return this;if(!c.blur)return this;var e=a(this).data("rating.input")||a(this.tagName=="INPUT"?this:null);c.blur&&c.blur.apply(e[0],[e.val(),a("a",e.data("rating.star"))[0]])},fill:function(){var a=this.data("rating");if(!a)return this;a.readOnly||(this.rating("drain"),this.prevAll().andSelf().filter(".rater-"+a.serial).addClass("star-rating-hover"))},
drain:function(){var a=this.data("rating");if(!a)return this;a.readOnly||a.rater.children().filter(".rater-"+a.serial).removeClass("star-rating-on").removeClass("star-rating-hover")},draw:function(){var c=this.data("rating");if(!c)return this;this.rating("drain");c.current?(c.current.data("rating.input").attr("checked","checked"),c.current.prevAll().andSelf().filter(".rater-"+c.serial).addClass("star-rating-on")):a(c.inputs).removeAttr("checked");c.cancel[c.readOnly||c.required?"hide":"show"]();this.siblings()[c.readOnly?
"addClass":"removeClass"]("star-rating-readonly")},select:function(c,e){var d=this.data("rating");if(!d)return this;if(!d.readOnly){d.current=null;if(typeof c!="undefined"){if(typeof c=="number")return a(d.stars[c]).rating("select",void 0,e);typeof c=="string"&&a.each(d.stars,function(){a(this).data("rating.input").val()==c&&a(this).rating("select",void 0,e)})}else d.current=this[0].tagName=="INPUT"?this.data("rating.star"):this.is(".rater-"+d.serial)?this:null;this.data("rating",d);this.rating("draw");
var f=a(d.current?d.current.data("rating.input"):null);(e||e==void 0)&&d.callback&&d.callback.apply(f[0],[f.val(),a("a",d.current)[0]])}},readOnly:function(c,e){var d=this.data("rating");if(!d)return this;d.readOnly=c||c==void 0?!0:!1;e?a(d.inputs).attr("disabled","disabled"):a(d.inputs).removeAttr("disabled");this.data("rating",d);this.rating("draw")},disable:function(){this.rating("readOnly",!0,!0)},enable:function(){this.rating("readOnly",!1,!1)}});a.fn.rating.options={cancel:"Cancel Rating",cancelValue:"",
split:0,starWidth:16};a(function(){a("input[type=radio].star").rating()})}(jQuery);
(function(){$(function(){window.compressText=function(a,f){if(a.length<f)return a;return a.substring(0,f-2)+"..."};window.setElementCover=function(a,f){var c,e;c='<a href="/'+f[0].author_slug+"/"+f[0].cached_slug+'" class="no-underline">';a.children(".stable").append(c+'<img src="http://spreadsong-book-covers.s3.amazonaws.com/book_id'+f[0].id+'_size3.jpg"/></a>');a.hasClass("cover-with-title-here")&&(e=a.hasClass("small")?40:61,a.append('<div class="text" style="display:none"> '+c+'<span class="title">'+
compressText(f[0].pretty_title,e)+'</span></a><span class="type">Book</span></div>'));return $(".cover-here img, .cover-with-title-here img").bind("load",function(){return $(this).parents("a").siblings(".spinner").fadeOut(200,function(){$(this).parents().siblings(".text").fadeIn(1E3);return $(this).siblings("a").children("img").fadeIn(1E3)})})};window.setCoverForAudiobook=function(a,f){var c,e;c='<a href="/'+f[0].author_slug+"/"+f[0].cached_slug+'" class="no-underline">';a.children(".stable").append(c+
'<img src="http://spreadsong-audiobook-covers.s3.amazonaws.com/audiobook_id'+f[0].id+'_size3.jpg"/></a>');a.hasClass("cover-with-title-here")&&(e=a.hasClass("small")?40:61,a.append('<div class="text" style="display:none">'+c+'<span class="title">'+compressText(f[0].pretty_title,e)+'</span></a><span class="type">Audiobook</span></div>'));return $(".cover-here img, .cover-with-title-here img").bind("load",function(){return $(this).parents("a").siblings(".spinner").fadeOut(200,function(){$(this).parents().siblings(".text").fadeIn(1E3);
return $(this).siblings("a").children("img").fadeIn(1E3)})})};return window.coversForRelatedBooks=function(){var a,f,c;a=$("ul.book-list li").map(function(){return $(this).attr("id").split("_")[1]});a=a.get();c=(f=$("ul.book-list").hasClass("audiobooks"))?"/json_audiobooks":"/json_books";a=$(a).get().join(",");return $.getJSON(c,{id:a},function(a){return $.each(a,function(a,c){var e,i;e=[c.attrs];i=(f?"ul.book-list li#audiobook_":" ul.book-list li#book_")+c.attrs.id+" .cover-here";return f?setCoverForAudiobook($(i),
e):setElementCover($(i),e)})})}})})();
(function(){$(function(){var a,f,c,e,d;$("img.cover-art").each(function(){var a,c;if($(this).height()<155)return a=155-$(this).height(),c=$(this).offset().left,a=$(this).offset().top+a,$(this).offset(a,c)});f=$("#right-column .row .cover-here.popular, #right-column .row .cover-with-title-here.popular");$("#right-column .row").hasClass("audiobooks")?(e="/random_json_audiobooks/",a=!0):e="/random_json_books/";$.getJSON(e+f.size(),function(c){return $.each(f,function(){var d;d=c.splice(Math.floor(Math.random()*
c.length),1);return a?setCoverForAudiobook($(this),d):setElementCover($(this),d)})});e=$(".random-book");e.get(0)&&(c=e.size());e.get(0)&&$.getJSON("/random_json_books/"+c,function(a){return $.each($(".random-book"),function(){var c;c=a.splice(Math.floor(Math.random()*NaN),1);return setElementCover($(this),c)})});c=$(".random-audiobook");c.get(0)&&(d=c.size());return c.get(0)?$.getJSON("/random_json_audiobooks/"+d,function(a){return $.each($(".random-audiobook"),function(){var c;c=a.splice(Math.floor(Math.random()*
NaN),1);return window.setCoverForAudiobook($(this),c)})}):null})})();
(function(a){var f=a.event,c;f.special.smartresize={setup:function(){a(this).bind("resize",f.special.smartresize.handler)},teardown:function(){a(this).unbind("resize",f.special.smartresize.handler)},handler:function(a,d){var f=this,h=arguments;a.type="smartresize";c&&clearTimeout(c);c=setTimeout(function(){jQuery.event.handle.apply(f,h)},d==="execAsap"?0:100)}};a.fn.smartresize=function(a){return a?this.bind("smartresize",a):this.trigger("smartresize",["execAsap"])};a.fn.masonry=function(c,d){var f=
{getBricks:function(a,c,b){var d=b.itemSelector===void 0;c.$bricks=b.appendedContent===void 0?d?a.children():a.find(b.itemSelector):d?b.appendedContent:b.appendedContent.filter(b.itemSelector)},placeBrick:function(c,d,b,e,f){d=Math.min.apply(Math,b);for(var m=d+c.outerHeight(!0),k=b.length,j=k,n=e.colCount+1-k;k--;)b[k]==d&&(j=k);c.applyStyle({left:e.colW*j+e.posLeft,top:d},a.extend(!0,{},f.animationOptions));for(k=0;k<n;k++)e.colY[j+k]=m},setup:function(a,c,b){f.getBricks(a,b,c);if(b.masoned)b.previousData=
a.data("masonry");b.colW=c.columnWidth===void 0?b.masoned?b.previousData.colW:b.$bricks.outerWidth(!0):c.columnWidth;b.colCount=Math.floor(a.width()/b.colW);b.colCount=Math.max(b.colCount,1)},arrange:function(c,e,b){var g;(!b.masoned||e.appendedContent!==void 0)&&b.$bricks.css("position","absolute");if(b.masoned)b.posTop=b.previousData.posTop,b.posLeft=b.previousData.posLeft;else{c.css("position","relative");var l=a(document.createElement("div"));c.prepend(l);b.posTop=Math.round(l.position().top);
b.posLeft=Math.round(l.position().left);l.remove()}if(b.masoned&&e.appendedContent!==void 0){b.colY=b.previousData.colY;for(g=b.previousData.colCount;g<b.colCount;g++)b.colY[g]=b.posTop}else{b.colY=[];for(g=b.colCount;g--;)b.colY.push(b.posTop)}a.fn.applyStyle=b.masoned&&e.animate?a.fn.animate:a.fn.css;e.singleMode?b.$bricks.each(function(){var c=a(this);f.placeBrick(c,b.colCount,b.colY,b,e)}):b.$bricks.each(function(){var c=a(this),d=Math.ceil(c.outerWidth(!0)/b.colW);d=Math.min(d,b.colCount);if(d===
1)f.placeBrick(c,b.colCount,b.colY,b,e);else{var h=b.colCount+1-d,l=[];for(g=0;g<h;g++){var o=b.colY.slice(g,g+d);l[g]=Math.max.apply(Math,o)}f.placeBrick(c,h,l,b,e)}});b.wallH=Math.max.apply(Math,b.colY);c.applyStyle({height:b.wallH-b.posTop},a.extend(!0,[],e.animationOptions));b.masoned||setTimeout(function(){c.addClass("masoned")},1);d.call(b.$bricks);c.data("masonry",b)},resize:function(a,c,b){b.masoned=!!a.data("masonry");var d=a.data("masonry").colCount;f.setup(a,c,b);b.colCount!=d&&f.arrange(a,
c,b)}};return this.each(function(){var h=a(this),i={};i.masoned=!!h.data("masonry");var b=i.masoned?h.data("masonry").options:{},g=a.extend({},a.fn.masonry.defaults,b,c),l=b.resizeable;i.options=g.saveOptions?g:b;d=d||function(){};f.getBricks(h,i,g);if(!i.$bricks.length)return this;f.setup(h,g,i);f.arrange(h,g,i);!l&&g.resizeable&&a(window).bind("smartresize.masonry",function(){f.resize(h,g,i)});l&&!g.resizeable&&a(window).unbind("smartresize.masonry")})};a.fn.masonry.defaults={singleMode:!1,columnWidth:void 0,
itemSelector:void 0,appendedContent:void 0,saveOptions:!0,resizeable:!0,animate:!1,animationOptions:{}}})(jQuery);
